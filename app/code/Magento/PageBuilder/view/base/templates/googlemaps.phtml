<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

/**
 * @var Magento\PageBuilder\Block\GoogleMapsApi $block
 * @var Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer
 * @var Magento\Framework\Escaper $escaper
 */
?>

<?php
$script = <<<SCRIPT
    require.config({
        paths: {
            googleMaps: '" . $escaper->escapeJs($block->getLibraryUrl()); . "'
        },
        config: {
            'Magento_PageBuilder/js/utils/map': {
                style: '" . $escaper->escapeJs($block->getStyle()); . "'
            },
            'Magento_PageBuilder/js/content-type/map/preview': {
                apiKey: '" . $escaper->escapeJs($block->getApiKey()); . "',
                apiKeyErrorMessage: '" . $escaper->escapeJs($block->getInvalidApiKeyMessage()); . "'
            },
            'Magento_PageBuilder/js/form/element/map': {
                apiKey: '" . $escaper->escapeJs($block->getApiKey()); . "',
                apiKeyErrorMessage: '" . $escaper->escapeJs($block->getInvalidApiKeyMessage()); . "'
            },
        }
    });
SCRIPT;
echo $secureRenderer->renderTag('script', [], $script, false);
?>

<?php
/** Include the googleMaps dependency only if we have an API key set, this removes unnecessary calls to Google */
if ($block->shouldIncludeGoogleMapsLibrary()) {
    $script = <<<SCRIPT

    require.config({
        shim: {
            'Magento_PageBuilder/js/utils/map': {
                deps: ['googleMaps']
            }
        }
    });
SCRIPT;
echo $secureRenderer->renderTag('script', [], $script, false);
}
?>
